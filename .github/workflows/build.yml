on: [ 'push', 'pull_request' ]

name: Build PHP Extensions

jobs:
  release:
    name: Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref }}
          release_name: Release ${{ github.ref }}
          draft: false
          prerelease: false
  yasd:
    name: Build YASD
    runs-on: ubuntu-latest
    strategy:
      matrix:
        php-version: [ '7.3', '7.4' ]
        alpine-version: [ '3.9', '3.10', '3.11', '3.12' ]
      max-parallel: 8
      fail-fast: false
    env:
      PHP_VERSION: ${{ matrix.php-version }}
      ALPINE_VERSION: ${{ matrix.alpine-version }}
      YASD_VERSION: "v0.3.7"
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Build Yasd
        run: cd yasd && ./build.sh


